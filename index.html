<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>Yume Ai Fantasy</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
        }

        #titleScreen {
            display: flex;
            justify-content: center;
            align-items: center;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1000;
            background: url('https://tsukimao.github.io/yumeaifantasy/YUMEAIFANTASY.title.gif') no-repeat center center fixed;
            -webkit-background-size: contain;
            -moz-background-size: contain;
            -o-background-size: contain;
            background-size: contain;
        }

        #titleScreen img {
            display: none;
        }

        #battleScreen {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            overflow: hidden;
        }

        .character {
            position: absolute;
            width: 100px;
            height: auto;
            bottom: 100px;
        }

        #hero {
            right: 10px;
        }

        #boss {
            left: 10px;
        }

        #commands {
            position: fixed;
            left: 0;
            bottom: 10px;
            width: 30%;
            height: 60px;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: space-around;
            padding: 10px;
        }

        #messages {
            position: fixed;
            right: 0;
            bottom: 10px;
            width: 70%;
            height: 150px;
            background: rgba(0, 0, 0, 0.5);
            color: white;
            padding: 10px;
            overflow-y: auto;
        }

        #status {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            text-align: center;
            font-size: 18px;
            color: white;
            background: rgba(0, 0, 0, 0.5);
        }

        #story {
            position: fixed;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            width: 300px;
            height: auto;
            max-height: 150px;
            background: rgba(0, 0, 0, 0.5);
            color: white;
            padding: 10px;
            overflow-y: auto;
        }

        @keyframes flash-animation {
            0% { background-color: white; }
            100% { background-color: transparent; }
        }

        .flash-effect {
            animation: flash-animation 0.5s ease-in-out;
        }
    </style>
</head>
<body>
    <div id='titleScreen' onclick='startGame()'></div>
    <div id='battleScreen'>
        <img src='https://tsukimao.github.io/yumeaifantasy/yumeaimatsuri.png' id='hero' class='character'>
        <img src='https://tsukimao.github.io/yumeaifantasy/boss.png' id='boss' class='character'>
        <div id='commands'>
            <button onclick='attack()'>たたかう</button>
            <button onclick='talk()'>はなす</button>
            <button onclick='castMagic()'>まほう</button>
            <button onclick='runAway()'>にげる</button>
        </div>
        <div id='messages'></div>
        <div id='status'>
            MATSURI: HP: <span id='heroHP'>100</span> MP: <span id='heroMP'>50</span>
        </div>
        <div id='story'></div>
    </div>
    <script>
        let heroHP = 100;
        let heroMP = 50;
        let bossHP = 200;
        let bossDamage = 0;
        let gameState = 'title';
        let storyIndex = 0;
        let attackCount = 0;

        const story_parts = [
          "MATSURIはデジタルワールドの調査員。ある日、怪しい影を追いかけてUNKNOWNと出会いました。",
          "UNKNOWNは、人間の血を吸い、ゾンビに変えると噂される化け物です。",
          "最初は攻撃してきませんが、余裕を見せています。",
          "MATSURIは戦うか、話すか、魔法を使うか、逃げるかを賢く選ばなければなりません。",
          "MATSURIが戦うと、UNKNOWNの暗い過去と吸血鬼の話を聞かされます。",
          "UNKNOWN: 『私はかつて人間だった。だが、運命は私を吸血鬼へと変えた。』",
          "UNKNOWN: 『伝説では、吸血鬼は十字架や聖水に弱いとされている。しかし、それは迷信だ。』",
          "UNKNOWN: 『私は何百年も生きてきた。だが、その長い年月は孤独と寂寥に満ちていた。』",
          "MATSURIがダメージを与えると、UNKNOWNは嘘の吸血鬼話でMATSURIの血を吸おうとしてきます。",
          "UNKNOWN: 『吸血鬼は永遠の命を持つ。だが、その代償として愛する者への苦しみを知る。』",
          "MATSURIが吸血鬼の弱点を見出し、最後のコマンド選択で攻撃しようとしたところ、UNKNOWNは逃げました。",
        ];

        const vampireStories = [
          "吸血鬼は人間の血を吸い、永遠の命を手に入れる。",
          "私はかつて美しい花嫁だった。だが、運命は私を吸血鬼へと変えた。",
          "吸血鬼は月明かりを避ける。太陽は私たちの敵だ。",
          "吸血鬼は人間の心を操り、恐怖を植え付ける。",
          "吸血鬼は一度死んだ者たち。だが、私はその中でも最も恐ろしい。",
          "私は何百年も生きてきた。だが、その長い年月は孤独と寂寥に満ちていた。",
          "吸血鬼は人間をゾンビに変えると噂される。だが、それは嘘だ。",
          "昔、吸血鬼は一族を形成し、世界を支配していた。",
          "吸血鬼は夜に活動する。だが、私は日中でも活動できる。",
          "私はかつて人間だった。だが、運命は私を吸血鬼へと変えた。",
        ];

        function startGame() {
            document.getElementById('titleScreen').style.display = 'none';
            document.getElementById('battleScreen').style.display = 'block';
            gameState = 'battle';
            displayStory();
            updateStatus();
        }

        function displayStory() {
            if (storyIndex < story_parts.length) {
                document.getElementById('story').innerHTML = story_parts[storyIndex];
                storyIndex++;
            }
        }

        function attack() {
            if (gameState === 'battle') {
                document.getElementById('messages').innerHTML = 'MATSURI attacks UNKNOWN!<br>';
                bossHP -= 20;
                bossDamage += 20;
                attackCount++;
                if (bossDamage >= 100) {
                    endGame();
                } else {
                    let randomIndex = Math.floor(Math.random() * vampireStories.length);
                    document.getElementById('messages').innerHTML += vampireStories[randomIndex] + '<br>';
                    displayStory();
                    bossAttack();
                }
                addFlashEffect();
                updateStatus();
            }
        }

        function castMagic() {
            if (gameState === 'battle' && heroMP >= 10) {
                document.getElementById('messages').innerHTML = 'MATSURI casts magic!<br>';
                bossHP -= 40;
                bossDamage += 40;
                heroMP -= 10;
                if (bossDamage >= 100) {
                    endGame();
                } else {
                    let randomIndex = Math.floor(Math.random() * vampireStories.length);
                    document.getElementById('messages').innerHTML += vampireStories[randomIndex] + '<br>';
                    displayStory();
                    bossAttack();
                }
                addFlashEffect();
                updateStatus();
            }
        }

        function talk() {
            if (gameState === 'battle') {
                let randomIndex = Math.floor(Math.random() * vampireStories.length);
                document.getElementById('messages').innerHTML = vampireStories[randomIndex] + '<br>';
                displayStory();
            }
        }

        function runAway() {
            if (gameState === 'battle') {
                document.getElementById('messages').innerHTML = 'MATSURI runs away!<br>';
                endGame();
            }
        }

        function updateStatus() {
            document.getElementById('heroHP').textContent = heroHP;
            document.getElementById('heroMP').textContent = heroMP;
        }

        function bossAttack() {
            if (gameState === 'battle') {
                document.getElementById('messages').innerHTML += 'UNKNOWN tries to suck MATSURI\'s blood!<br>';
                heroHP -= Math.floor(Math.random() * 20);
                if (heroHP <= 1) {
                    endGame();
                }
                updateStatus();
            }
        }

        function endGame() {
            gameState = 'end';
            displayStory();
            document.getElementById('battleScreen').style.display = 'none';
            document.body.style.backgroundColor = 'rgba(0, 0, 0, 0.8)';
            document.getElementById('story').innerHTML = 'ゲームクリア';
            document.getElementById('story').style.fontSize = '3em';
        }

        function addFlashEffect() {
            document.body.classList.add('flash-effect');
            setTimeout(() => {
                document.body.classList.remove('flash-effect');
            }, 500);
        }
    </script>
</body>
</html>
